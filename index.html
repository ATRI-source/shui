<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾ç¾è®°è´¦æµæ°´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .header h1 {
            position: relative;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            position: relative;
            font-size: 16px;
            opacity: 0.9;
        }
        
        .input-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5ee;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }
        
        button {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.4);
        }
        
        .records-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        
        .section-title {
            font-size: 22px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            font-weight: 600;
        }
        
        .record {
            padding: 18px 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .record:hover {
            background-color: #f9f9ff;
            border-radius: 10px;
            transform: translateX(5px);
        }
        
        .record:last-child {
            border-bottom: none;
        }
        
        .record-info {
            flex: 1;
        }
        
        .record-description {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        
        .record-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .record-date {
            font-size: 13px;
            color: #888;
        }
        
        .record-amount {
            font-weight: bold;
            font-size: 18px;
            color: #e74c3c;
        }
        
        .total {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f4 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            font-weight: 600;
            font-size: 18px;
            color: #2c3e50;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .total span {
            color: #e74c3c;
            font-size: 22px;
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 15px;
        }
        
        .delete-btn:hover {
            transform: scale(1.05);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }
        
        .empty-state p {
            font-size: 18px;
            margin-top: 10px;
        }
        
        .category-food { background-color: #ffeaa7; color: #d35400; }
        .category-transport { background-color: #74b9ff; color: #192a56; }
        .category-shopping { background-color: #fd79a8; color: #2d3436; }
        .category-entertainment { background-color: #fdcb6e; color: #2d3436; }
        .category-living { background-color: #6c5ce7; color: #f7f7f7; }
        .category-medical { background-color: #e17055; color: #f7f7f7; }
        .category-other { background-color: #a29bfe; color: #2d3436; }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .month-year-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-top: 20px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .summary-item:hover {
            background-color: #f9f9ff;
            border-radius: 8px;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-weight: 600;
            color: #333;
        }
        
        .summary-value {
            font-weight: 600;
            color: #e74c3c;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .detail-section {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            margin-top: 20px;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .detail-title {
            font-size: 22px;
            color: #333;
            font-weight: 600;
        }
        
        .detail-total {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- ä¸»é¡µé¢ -->
    <div id="main-page" class="page active">
        <div class="header">
            <h1>ğŸ’° ç²¾ç¾è®°è´¦</h1>
            <p>è½»æ¾è®°å½•æ¯ä¸€ç¬”æ”¯å‡º</p>
        </div>
        
        <div class="input-section">
            <div class="form-group">
                <label for="amount">ğŸ’° æ”¯å‡ºé‡‘é¢</label>
                <input type="number" id="amount" placeholder="è¾“å…¥æ”¯å‡ºé‡‘é¢" step="0.01" min="0">
            </div>
            
            <div class="form-group">
                <label for="category">ğŸ·ï¸ åˆ†ç±»</label>
                <select id="category">
                    <option value="é¤é¥®">é¤é¥®</option>
                    <option value="äº¤é€š">äº¤é€š</option>
                    <option value="è´­ç‰©">è´­ç‰©</option>
                    <option value="å¨±ä¹">å¨±ä¹</option>
                    <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
                    <option value="åŒ»ç–—">åŒ»ç–—</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="description">ğŸ“ å¤‡æ³¨</label>
                <textarea id="description" placeholder="è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" rows="2"></textarea>
            </div>
            
            <button id="add-record">â• æ·»åŠ æ”¯å‡ºè®°å½•</button>
        </div>
        
        <div class="records-section">
            <h2 class="section-title">ğŸ“‹ ä»Šæ—¥æµæ°´è®°å½•</h2>
            <div id="records-list">
                <!-- è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
            <div class="total">
                ä»Šæ—¥æ€»æ”¯å‡º: <span id="total-amount">Â¥0.00</span>
            </div>
        </div>
        
        <div class="nav-buttons">
            <button class="nav-btn" id="month-btn">ğŸ“… æœˆåº¦è®°å½•</button>
            <button class="nav-btn" id="year-btn"> yearly</button>
        </div>
    </div>
    
    <!-- æœˆåº¦è®°å½•é¡µé¢ -->
    <div id="month-page" class="page">
        <button class="back-btn" id="back-to-main">â† è¿”å›é¦–é¡µ</button>
        
        <div class="month-year-section">
            <h2 class="section-title">ğŸ“… æœˆåº¦è®°å½•</h2>
            <div id="month-records">
                <!-- æœˆåº¦è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
            <div class="total">
                æœˆåº¦æ€»æ”¯å‡º: <span id="month-total">Â¥0.00</span>
            </div>
        </div>
    </div>
    
    <!-- æœˆåº¦è¯¦æƒ…é¡µé¢ -->
    <div id="month-detail-page" class="page">
        <button class="back-btn" id="back-to-month">â† è¿”å›æœˆåº¦</button>
        
        <div class="detail-section">
            <div class="detail-header">
                <div class="detail-title" id="detail-date">æ—¥æœŸè¯¦æƒ…</div>
                <div class="detail-total" id="detail-total">Â¥0.00</div>
            </div>
            <div id="detail-records">
                <!-- è¯¦æƒ…è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
        </div>
    </div>
    
    <!-- å¹´åº¦è®°å½•é¡µé¢ -->
    <div id="year-page" class="page">
        <button class="back-btn" id="back-to-main-year">â† è¿”å›é¦–é¡µ</button>
        
        <div class="month-year-section">
            <h2 class="section-title"> yearly</h2>
            <div id="year-records">
                <!-- å¹´åº¦è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
            <div class="total">
                å¹´åº¦æ€»æ”¯å‡º: <span id="year-total">Â¥0.00</span>
            </div>
        </div>
    </div>
    
    <!-- å¹´åº¦è¯¦æƒ…é¡µé¢ -->
    <div id="year-detail-page" class="page">
        <button class="back-btn" id="back-to-year">â† è¿”å›å¹´åº¦</button>
        
        <div class="detail-section">
            <div class="detail-header">
                <div class="detail-title" id="detail-month">æœˆä»½è¯¦æƒ…</div>
                <div class="detail-total" id="detail-month-total">Â¥0.00</div>
            </div>
            <div id="detail-month-records">
                <!-- æœˆä»½è¯¦æƒ…è®°å½•å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ•°æ®
        let records = JSON.parse(localStorage.getItem('expenseRecords')) || [];
        const today = new Date().toISOString().split('T')[0];
        const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
        const currentYear = new Date().getFullYear().toString(); // YYYY
        
        // å½“å‰é¡µé¢çŠ¶æ€
        let currentPage = 'main';
        let selectedDate = '';
        let selectedMonth = '';
        
        // åˆ‡æ¢é¡µé¢å‡½æ•°
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            // å¦‚æœåˆ‡æ¢åˆ°æœˆåº¦æˆ–å¹´åº¦é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“å¯¹åº”æ•°æ®
            if (pageId === 'month-page') {
                renderMonthRecords();
            } else if (pageId === 'year-page') {
                renderYearRecords();
            }
        }
        
        // è¿‡æ»¤ä»Šå¤©çš„è®°å½•
        function getTodayRecords() {
            return records.filter(record => record.date === today);
        }
        
        // è¿‡æ»¤æŒ‡å®šæ—¥æœŸçš„è®°å½•
        function getRecordsByDate(date) {
            return records.filter(record => record.date === date);
        }
        
        // è¿‡æ»¤æŒ‡å®šæœˆä»½çš„è®°å½•
        function getRecordsByMonth(month) {
            return records.filter(record => record.date.startsWith(month));
        }
        
        // è¿‡æ»¤å½“å‰æœˆçš„è®°å½•
        function getMonthRecords() {
            return records.filter(record => record.date.startsWith(currentMonth));
        }
        
        // è¿‡æ»¤å½“å‰å¹´çš„è®°å½•
        function getYearRecords() {
            return records.filter(record => record.date.startsWith(currentYear));
        }
        
        // æŒ‰æ—¥æœŸåˆ†ç»„è®°å½•
        function groupRecordsByDate(recordsArray) {
            const grouped = {};
            recordsArray.forEach(record => {
                const date = record.date;
                if (!grouped[date]) {
                    grouped[date] = [];
                }
                grouped[date].push(record);
            });
            return grouped;
        }
        
        // æŒ‰æœˆä»½åˆ†ç»„è®°å½•
        function groupRecordsByMonth(recordsArray) {
            const grouped = {};
            recordsArray.forEach(record => {
                const month = record.date.slice(0, 7); // YYYY-MM
                if (!grouped[month]) {
                    grouped[month] = [];
                }
                grouped[month].push(record);
            });
            return grouped;
        }
        
        // æ¸²æŸ“ä»Šæ—¥è®°å½•
        function renderRecords() {
            const todayRecords = getTodayRecords();
            const recordsList = document.getElementById('records-list');
            
            if (todayRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <p>æš‚æ— è®°å½•</p>
                        <p>æ·»åŠ ç¬¬ä¸€ç¬”æ”¯å‡ºå§ï¼</p>
                    </div>
                `;
                document.getElementById('total-amount').textContent = 'Â¥0.00';
                return;
            }
            
            recordsList.innerHTML = '';
            
            let total = 0;
            
            todayRecords.forEach((record, index) => {
                total += record.amount;
                
                // æ ¹æ®åˆ†ç±»è®¾ç½®é¢œè‰²
                let categoryClass = 'record-category ';
                switch(record.category) {
                    case 'é¤é¥®':
                        categoryClass += 'category-food';
                        break;
                    case 'äº¤é€š':
                        categoryClass += 'category-transport';
                        break;
                    case 'è´­ç‰©':
                        categoryClass += 'category-shopping';
                        break;
                    case 'å¨±ä¹':
                        categoryClass += 'category-entertainment';
                        break;
                    case 'ç”Ÿæ´»ç”¨å“':
                        categoryClass += 'category-living';
                        break;
                    case 'åŒ»ç–—':
                        categoryClass += 'category-medical';
                        break;
                    default:
                        categoryClass += 'category-other';
                }
                
                const recordElement = document.createElement('div');
                recordElement.className = 'record';
                recordElement.innerHTML = `
                    <div class="record-info">
                        <div class="record-description">
                            ${record.description || 'æ— å¤‡æ³¨'}
                        </div>
                        <div>
                            <span class="${categoryClass}">${record.category}</span>
                            <span class="record-date">${formatTime(record.time)}</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <span class="record-amount">Â¥${record.amount.toFixed(2)}</span>
                        <button class="delete-btn" data-time="${record.time}">ğŸ—‘ï¸</button>
                    </div>
                `;
                
                // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const deleteBtn = recordElement.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', function() {
                    deleteRecord(record.time);
                });
                
                recordsList.appendChild(recordElement);
            });
            
            // æ›´æ–°æ€»é‡‘é¢
            document.getElementById('total-amount').textContent = `Â¥${total.toFixed(2)}`;
        }
        
        // æ¸²æŸ“æœˆåº¦è®°å½•
        function renderMonthRecords() {
            const monthRecords = getMonthRecords();
            const recordsList = document.getElementById('month-records');
            
            if (monthRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <p>æœ¬æœˆæš‚æ— è®°å½•</p>
                    </div>
                `;
                document.getElementById('month-total').textContent = 'Â¥0.00';
                return;
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const grouped = groupRecordsByDate(monthRecords);
            const dates = Object.keys(grouped).sort().reverse(); // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            
            recordsList.innerHTML = '';
            
            let total = 0;
            
            dates.forEach(date => {
                const dayRecords = grouped[date];
                const dayTotal = dayRecords.reduce((sum, record) => sum + record.amount, 0);
                total += dayTotal;
                
                const dateElement = document.createElement('div');
                dateElement.className = 'summary-item';
                dateElement.innerHTML = `
                    <div>
                        <div class="summary-label">${date}</div>
                        <div style="font-size: 12px; color: #888; margin-top: 5px;">
                            ${dayRecords.length} ç¬”è®°å½•
                        </div>
                    </div>
                    <div class="summary-value">Â¥${dayTotal.toFixed(2)}</div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æŸ¥çœ‹è¯¦æƒ…
                dateElement.addEventListener('click', function() {
                    selectedDate = date;
                    showPage('month-detail-page');
                    renderMonthDetail();
                });
                
                recordsList.appendChild(dateElement);
            });
            
            // æ›´æ–°æ€»é‡‘é¢
            document.getElementById('month-total').textContent = `Â¥${total.toFixed(2)}`;
        }
        
        // æ¸²æŸ“æœˆåº¦è¯¦æƒ…
        function renderMonthDetail() {
            const dayRecords = getRecordsByDate(selectedDate);
            const recordsList = document.getElementById('detail-records');
            
            document.getElementById('detail-date').textContent = `${selectedDate} è¯¦ç»†è®°å½•`;
            
            if (dayRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <p>è¯¥æ—¥æœŸæš‚æ— è®°å½•</p>
                    </div>
                `;
                document.getElementById('detail-total').textContent = 'Â¥0.00';
                return;
            }
            
            recordsList.innerHTML = '';
            
            let total = 0;
            
            dayRecords.forEach(record => {
                total += record.amount;
                
                // æ ¹æ®åˆ†ç±»è®¾ç½®é¢œè‰²
                let categoryClass = 'record-category ';
                switch(record.category) {
                    case 'é¤é¥®':
                        categoryClass += 'category-food';
                        break;
                    case 'äº¤é€š':
                        categoryClass += 'category-transport';
                        break;
                    case 'è´­ç‰©':
                        categoryClass += 'category-shopping';
                        break;
                    case 'å¨±ä¹':
                        categoryClass += 'category-entertainment';
                        break;
                    case 'ç”Ÿæ´»ç”¨å“':
                        categoryClass += 'category-living';
                        break;
                    case 'åŒ»ç–—':
                        categoryClass += 'category-medical';
                        break;
                    default:
                        categoryClass += 'category-other';
                }
                
                const recordElement = document.createElement('div');
                recordElement.className = 'record';
                recordElement.innerHTML = `
                    <div class="record-info">
                        <div class="record-description">
                            ${record.description || 'æ— å¤‡æ³¨'}
                        </div>
                        <div>
                            <span class="${categoryClass}">${record.category}</span>
                            <span class="record-date">${formatTime(record.time)}</span>
                        </div>
                    </div>
                    <div class="record-amount">Â¥${record.amount.toFixed(2)}</div>
                `;
                
                recordsList.appendChild(recordElement);
            });
            
            // æ›´æ–°æ€»é‡‘é¢
            document.getElementById('detail-total').textContent = `Â¥${total.toFixed(2)}`;
        }
        
        // æ¸²æŸ“å¹´åº¦è®°å½•
        function renderYearRecords() {
            const yearRecords = getYearRecords();
            const recordsList = document.getElementById('year-records');
            
            if (yearRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <p>æœ¬å¹´æš‚æ— è®°å½•</p>
                    </div>
                `;
                document.getElementById('year-total').textContent = 'Â¥0.00';
                return;
            }
            
            // æŒ‰æœˆä»½åˆ†ç»„
            const grouped = groupRecordsByMonth(yearRecords);
            const months = Object.keys(grouped).sort().reverse(); // æŒ‰æœˆä»½å€’åºæ’åˆ—
            
            recordsList.innerHTML = '';
            
            let total = 0;
            
            months.forEach(month => {
                const monthRecords = grouped[month];
                const monthTotal = monthRecords.reduce((sum, record) => sum + record.amount, 0);
                total += monthTotal;
                
                const monthElement = document.createElement('div');
                monthElement.className = 'summary-item';
                monthElement.innerHTML = `
                    <div>
                        <div class="summary-label">${month}</div>
                        <div style="font-size: 12px; color: #888; margin-top: 5px;">
                            ${monthRecords.length} ç¬”è®°å½•
                        </div>
                    </div>
                    <div class="summary-value">Â¥${monthTotal.toFixed(2)}</div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æŸ¥çœ‹è¯¦æƒ…
                monthElement.addEventListener('click', function() {
                    selectedMonth = month;
                    showPage('year-detail-page');
                    renderYearDetail();
                });
                
                recordsList.appendChild(monthElement);
            });
            
            // æ›´æ–°æ€»é‡‘é¢
            document.getElementById('year-total').textContent = `Â¥${total.toFixed(2)}`;
        }
        
        // æ¸²æŸ“å¹´åº¦è¯¦æƒ…
        function renderYearDetail() {
            const monthRecords = getRecordsByMonth(selectedMonth);
            const recordsList = document.getElementById('detail-month-records');
            
            document.getElementById('detail-month').textContent = `${selectedMonth} è¯¦ç»†è®°å½•`;
            
            if (monthRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="empty-state">
                        <p>è¯¥æœˆä»½æš‚æ— è®°å½•</p>
                    </div>
                `;
                document.getElementById('detail-month-total').textContent = 'Â¥0.00';
                return;
            }
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const grouped = groupRecordsByDate(monthRecords);
            const dates = Object.keys(grouped).sort().reverse(); // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            
            recordsList.innerHTML = '';
            
            let total = 0;
            
            dates.forEach(date => {
                const dayRecords = grouped[date];
                const dayTotal = dayRecords.reduce((sum, record) => sum + record.amount, 0);
                total += dayTotal;
                
                // æ·»åŠ æ—¥æœŸåˆ†ç»„æ ‡é¢˜
                const dateHeader = document.createElement('div');
                dateHeader.className = 'record';
                dateHeader.style.background = '#f9f9ff';
                dateHeader.style.margin = '10px 0';
                dateHeader.style.borderRadius = '8px';
                dateHeader.innerHTML = `
                    <div class="record-info">
                        <div class="record-description">${date}</div>
                    </div>
                    <div class="record-amount">Â¥${dayTotal.toFixed(2)}</div>
                `;
                
                recordsList.appendChild(dateHeader);
                
                // æ·»åŠ è¯¥æ—¥æœŸçš„æ¯æ¡è®°å½•
                dayRecords.forEach(record => {
                    // æ ¹æ®åˆ†ç±»è®¾ç½®é¢œè‰²
                    let categoryClass = 'record-category ';
                    switch(record.category) {
                        case 'é¤é¥®':
                            categoryClass += 'category-food';
                            break;
                        case 'äº¤é€š':
                            categoryClass += 'category-transport';
                            break;
                        case 'è´­ç‰©':
                            categoryClass += 'category-shopping';
                            break;
                        case 'å¨±ä¹':
                            categoryClass += 'category-entertainment';
                            break;
                        case 'ç”Ÿæ´»ç”¨å“':
                            categoryClass += 'category-living';
                            break;
                        case 'åŒ»ç–—':
                            categoryClass += 'category-medical';
                            break;
                        default:
                            categoryClass += 'category-other';
                    }
                    
                    const recordElement = document.createElement('div');
                    recordElement.className = 'record';
                    recordElement.style.paddingLeft = '20px';
                    recordElement.innerHTML = `
                        <div class="record-info">
                            <div class="record-description">
                                ${record.description || 'æ— å¤‡æ³¨'}
                            </div>
                            <div>
                                <span class="${categoryClass}">${record.category}</span>
                                <span class="record-date">${formatTime(record.time)}</span>
                            </div>
                        </div>
                        <div class="record-amount">Â¥${record.amount.toFixed(2)}</div>
                    `;
                    
                    recordsList.appendChild(recordElement);
                });
            });
            
            // æ›´æ–°æ€»é‡‘é¢
            document.getElementById('detail-month-total').textContent = `Â¥${total.toFixed(2)}`;
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(timeString) {
            const date = new Date(timeString);
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        // æ·»åŠ è®°å½•
        document.getElementById('add-record').addEventListener('click', function() {
            const amountInput = document.getElementById('amount');
            const categorySelect = document.getElementById('category');
            const descriptionInput = document.getElementById('description');
            
            const amount = parseFloat(amountInput.value);
            const category = categorySelect.value;
            const description = descriptionInput.value.trim();
            
            if (isNaN(amount) || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
                return;
            }
            
            const newRecord = {
                amount: amount,
                category: category,
                description: description,
                date: today,
                time: new Date().toISOString()
            };
            
            records.push(newRecord);
            localStorage.setItem('expenseRecords', JSON.stringify(records));
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            amountInput.value = '';
            descriptionInput.value = '';
            
            // é‡æ–°æ¸²æŸ“
            renderRecords();
        });
        
        // åˆ é™¤è®°å½•
        function deleteRecord(time) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                // ä»æ€»è®°å½•ä¸­åˆ é™¤å¯¹åº”æ—¶é—´çš„è®°å½•
                records = records.filter(r => r.time !== time);
                localStorage.setItem('expenseRecords', JSON.stringify(records));
                
                // é‡æ–°æ¸²æŸ“
                renderRecords();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“è®°å½•
        window.onload = function() {
            renderRecords();
            
            // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
            document.getElementById('month-btn').addEventListener('click', function() {
                showPage('month-page');
            });
            
            document.getElementById('year-btn').addEventListener('click', function() {
                showPage('year-page');
            });
            
            document.getElementById('back-to-main').addEventListener('click', function() {
                showPage('main-page');
            });
            
            document.getElementById('back-to-main-year').addEventListener('click', function() {
                showPage('main-page');
            });
            
            document.getElementById('back-to-month').addEventListener('click', function() {
                showPage('month-page');
            });
            
            document.getElementById('back-to-year').addEventListener('click', function() {
                showPage('year-page');
            });
        };
        
        // æ·»åŠ å›è½¦é”®æ”¯æŒ
        document.getElementById('amount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('add-record').click();
            }
        });
    </script>
</body>
</html>
